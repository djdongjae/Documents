# JVM의 메모리 할당 구조

### 운영체제에서의 메모리

---

#### 프로세스 개념
* 기본적으로 프로그램이란 이진 데이터와 명령어로 이루어진 기계어 덩어리입니다.
* 평소에는 SSD와 같은 보조 기억 장치에 적재되어 있다가, 실행을 하게 되면 메모리에 적재되어 CPU에 의해 한 줄씩 실행이 됩니다.
* 이와 같이 메모리에 적재된 프로그램을 프로세스라고 지칭합니다.

#### 프로세스의 메모리 할당 구조
메모리 영역에는 운영체제가 적재되는 커널 영역과 응용 프로그램, 즉 프로세스가 적재되는 사용자 영역이 존재하는데 사용자 영역에는 크게 코드 영역, 데이터 영역, 힙 영역, 스택 영역으로 구분됩니다.
![Alt text](<image/Screenshot 2024-03-28 at 4.32.32 PM.png>)

* **정적 할당 영역**: 크기가 고정된 영역. 프로그램이 실행되는 동안 유지되는 데이터가 저장되는 공간
    * 코드 영역: 기계어로 이루어진 명령어 저장
    * 데이터 영역: 프로그램이 실행되는 동안 유지될 데이터가 저장되는 공간(전역 변수 등)
* **동적 할당 영역**: 실행 과정에서 그 크기가 변할 수 있는 영역
    * 힙 영역: 프로그래머가 직접 할당할 수 있는 저장 공간(메모리 공간을 할당했다면 언젠가는 공간을 반환해야 함. 그렇지 않으면 메모리 누수가 발생)
    * 스택 영역: 데이터를 일시적으로 저장하는 공간으로 함수의 실행이 끝나면 사라지는 공간 (매개변수, 지역변수 등)

#### 가상 머신 (Virtual Machine)
가상 머신이란 소프트웨어적으로 만들어낸 가상 컴퓨터를 말합니다. 가상 머신을 설치하면 새로운 운영체제와 응용 프로그램을 설치하고 실행할 수 있습니다.


### JVM의 동작 방식과 메모리 할당 구조

---

#### .java 코드 작성부터 동작까지
* 우선 개발자가 Java 언어로 프로그램을 작성하게 되면 .java 형식의 텍스트 파일이 생성되게 됩니다. 이를 소스파일이라고 지칭하며, 해당 소스파일은 javac 명령어를 통해 .class 형태의 바이트 코드 파일로 변환이 됩니다. 
* 윈도우, 맥OS, 리눅스 등 어떤 운영체제라 하더라도 동일한 소스파일을 javac로 컴파일하면 모두 동일한 바이트코드 파일이 생성됩니다. 바이트코드 파일을 특정 운영체제가 이해하는 기계어로 번역하고 실행시키기 위해서는 JVM이 구동되어야 합니다.
![Alt text](image/EbG3PBV7aBDVPqGHlTlpGRugqZ5vS9ocYXCyXiFlV8FDr9hjVQwmr0rI7t52fbVariyoCOZ4LaACbW3CDJ9qN0Y-LiLWRCyqQbqrOwhfvn_bNcENtp5wkxu4wtPuHuUy95CeuF6YwAITECa23QUr1A.gif)
* JVM, 즉 자바 가상머신은 java 명령어를 통해 실행되고, 이 과정에서 JVM과 JVM이 구동되기 위한 라이브러리 등의 환경을 포괄하여 지칭하는 단어를 JRE라고 합니다. 
* JDK의 경우 JRE, java 명령어, javac 명령어 모두를 포함하는 단어입니다. JDK의 경우 운영체제별로 설치하는 종류가 다른데, 이는 JVM때문입니다. 바이트코드 파일까지는 운영체제와 상관없이 모두 동일한 내용으로 생성되지만, JVM은 각각의 운영체제에서 이해하는 기계어로 번역해야 하므로 그 종류가 다르게 설치됩니다. 이러한 과정으로 인해 코드의 변경 없이 다양한 운영체제에서 프로그램 실행이 가능하게 되는 것입니다.


#### JVM의 메모리 할당 구조
java 명령어로 JVM이 구동되면 JVM은 운영체제에서 할당받은 메모리 영역을 다음과 같이 구분해서 사용하게 됩니다.
![Alt text](<image/Screenshot 2024-03-28 at 7.15.00 PM.png>)
* **메소드 영역**: 운영체제에서의 데이터 영역에 해당한다고 보면 된다. 바이트코드 파일을 읽은 내용이 저장되는 영역으로 클래스별 상수, 정적 필드, 메소드 코드, 생성자 코드 등이 있습니다.
    > ✅ 참고로 인터페이스도 .java 파일로 작성되고 .class 파일로 컴파일되기 떄문에 물리적 형태는 클래스와 동일합니다.
* **힙 영역**: 객체와 배열이 생성되는 영역이다. new 연산자를 통해 생성되는 데이터가 바로 이곳에 저장됩니다.
    > ✅ java의 가비지 컬렉션은 이곳에서 참조되지 않는 객체를 자동으로 메모리에서 제거한다. 이에 따라 앞서 설명한 메모리 누수의 문제를 예방할 수 있습니다.
* **스택 영역**: 메소드를 호출할 때마다 생성되는 프레임이 저장되는 영역입니다. 메소드 호출이 끝나면 프레임은 자동 제거되고, 프레임 내부에는 로컬 변수 스택이 존재합니다. 이곳에서 기본 타입 변수와 참조 타입 변수가 생성되고 제거됩니다.
    > ✅ 무한 재귀 호출 등의 문제로 인해 발생하는 스택 오버플로우(Stack Overflow) 예외가 바로 이곳에서 발생합니다.

![Alt text](<image/Screenshot 2024-03-28 at 7.36.01 PM.png>)